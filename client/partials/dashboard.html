<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="/#!">Discuss</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse in" aria-expanded="true">
      <ul class="nav navbar-nav navbar-right">
        <span>Welcome <span ng-bind="currentUser.username"></span>!
        <input class="" type="button" value="Sign Out" ng-click="logout()">
      </ul>
    </div>
  </div>
</nav>

<div class="box" id="search-bar">
  <input type="search" name="search" ng-model="searchQuery">
  <input type="button" class="button" value="Search" ng-click="search()">

</div>

<table>
  <tr>
    <th>Category</th>
    <th>Topic</th>
    <th>Username</th>
    <th>Posts</th>
  </tr>
  <tr ng-repeat="topic in topics">
    <td>{{topic._category.name}}</td>
    <td><a href="/topics/{{topic._id}}">{{topic.title}}</a></td>
    <td><a href="/user/{{topic._user._id}}">{{topic._user.username}}</a></td>
    <td>{{topic.posts.length}}</td>
  </tr>
</table>

<div class="box">
  <form ng-submit="addTopic()">
    <legend>Add a new Topic</legend>

    <input type="hidden" name="user" ng-model="newTopic._author" value="{{currentUser.id}}">

    <label for="title">Title:</label>
    <input type="text" name="title" ng-model="newTopic.title">

    <label for="description">Description:</label>
    <textarea name="description" rows="3" cols="30" ng-model="newTopic.description"></textarea>

    <label for="category">Category:</label>
    <select name="category" ng-model="newTopic._category">
      <option ng-repeat="category in categories" value="{{category._id}}">{{category.name}}</option>
    </select>

    <input type="submit" class="button" value="Submit">
  </form>
</div>


<div class="box">
  <form ng-submit="addPost()">
    <label>Post a message:</label>
    <textarea rows="3" cols="30" ng-model="newpost.posttext"></textarea>
    <input class="button" type="submit" value="Post">
  </form>
</div>



<span ng-repeat="post in posts">
  <div class="box">
    <p class="timestamp"><span ng-bind="post._author.username"></span>: <span ng-bind="post.createdAt|date:'medium'"></span></p>
    <p class="post" ng-bind="post.postText"></p>
    <span ng-repeat="comment in comments">
      <span ng-if="comment._post._id === post._id">
          <p class="timestamp"><span ng-bind="comment._author.username"></span>: <span ng-bind="comment.createdAt|date:'medium'"></span></p>
          <p ng-bind="comment.commentText"></p>
      </span>
    </span>
    <form ng-submit="addComment(post._id, newcomment)">
      <textarea rows="3" cols="30" ng-model="newcomment.commenttext"></textarea>
      <input class="button" type="submit" value="Comment">
    </form>
  </div>
</span>
